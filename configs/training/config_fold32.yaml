# ============================================================================
# DATASET CONFIGURATION FILE - HYBRID DATASET
# (CRC + Xenium + TissueNet + PanNuke + Lizard + MoNuSeg + TNBC + NuInsSeg + CryoNuSeg + BC + ConSep + Kumar + CPM-17)
# ============================================================================

# ============================================================================
# 1. DATA PATHS
# ============================================================================
data:
  zarr_bases:
    crc: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/ORION-CRC/zarr_data"
    xenium: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/Xenium/zarr_data"
    tissuenet: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/tissuenet/zarr_data"
    pannuke: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/pannuke/zarr_data"
    lizard: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/lizard/zarr_data"
    monuseg: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/monuseg/zarr_data"
    tnbc: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/tnbc/zarr_data"
    nuinsseg: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/nuinsseg/zarr_data"
    cryonuseg: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/cryonuseg/zarr_data"
    bc: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/bcdata/zarr_data"
    consep: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/consep/zarr_data"
    monusac: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/monusac/zarr_data"
    kumar: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/kumar/zarr_data"
    cpm17: "/rsrch9/home/plm/idso_fa1_pathology/TIER2/yasin-vitaminp/cpm17/zarr_data"
  cache_dir: "./cache"
  cache_filename: "multimodal_dataset_cache_fold1.pkl"

# ============================================================================
# 2. SAMPLE SPLITS
# ============================================================================
splits:
  # --------------------------------------------------------------------------
  # TRAIN SET (Optimization)
  # --------------------------------------------------------------------------
  train_samples:
    # --- PanNuke (Folds 1 & 2) ---
    - pannuke_train
    
    # --- TissueNet ---
    - tissuenet_train
    
    # --- Lizard (85% Split) ---
    - lizard_train
    
    # --- MoNuSeg (Training Set) ---
    - monuseg_train
    
    # --- TNBC (Training Set) ---
    - tnbc_train
    
    # --- NuInsSeg (Training Set) ---
    - nuinsseg_train
    
    # --- CryoNuSeg (Training Set) ---
    - cryonuseg_train
    
    # --- BC (Training Set) ---
    - bc_train

    # --- ConSep (Training Set) ---
    - consep_train

    # --- MoNuSAC (Training Set) ---
    - monusac_train
    
    # --- Kumar (Training Set) ---
    - kumar_train

    # --- CPM-17 (Training Set) ---
    - cpm17_train

    # --- Xenium (Diverse Tissues) ---
    - breast
    - cervical
    - lung
    - lymph_node
    - ovarian
    - skin
    - pancreasV1
    
    # --- CRC (Primary Bulk) ---
    - CRC01
    - CRC02
    - CRC04
    - CRC05
    - CRC06
    - CRC07
    - CRC08
    - CRC10
    - CRC12
    - CRC13
    - CRC14
    - CRC15
    - CRC16
    - CRC17
    - CRC18
    - CRC19
    - CRC20
    - CRC21
    - CRC22
    - CRC23
    - CRC24
    - CRC25
    - CRC26
    - CRC27
    - CRC33_01
    - CRC33_02
    - CRC34
    - CRC35
    - CRC36
    - CRC29
    - CRC30
    - CRC31
    - CRC38
    - CRC39
    - CRC40

  # --------------------------------------------------------------------------
  # VALIDATION SET (Model Selection / Tuning)
  # --------------------------------------------------------------------------
  val_samples:
    # --- PanNuke (Fold 3) ---
    - pannuke_val
    
    # --- TissueNet ---
    - tissuenet_val
    
    # --- Lizard (5% Split) ---
    - lizard_val
    
    # --- TNBC (Validation Set) ---
    - tnbc_val
    
    # --- MoNuSeg (Validation Set) ---
    - monuseg_val

    # --- NuInsSeg (Validation Set) ---
    - nuinsseg_val
    
    # --- CryoNuSeg (Validation Set) ---
    - cryonuseg_val
    
    # --- BC (Validation Set) ---
    - bc_val

    # --- ConSep (Validation Set) ---
    - consep_val

    # --- MoNuSAC (Validation Set) ---
    - monusac_val

    # --- Kumar (Validation Set) ---
    - kumar_val

    # --- CPM-17 (Validation Set) ---
    - cpm17_val

    # --- Xenium ---
    - prostate
    - lungV1
    
    # --- CRC (Held-out subset) ---
    - CRC09
    - CRC28
    - CRC32

  # --------------------------------------------------------------------------
  # TEST SET (Final Evaluation)
  # --------------------------------------------------------------------------
  test_samples:
    # --- Pannuke ---  
    - pannuke_test

    # --- TissueNet ---
    - tissuenet_test
    
    # --- Lizard (10% Split) ---
    - lizard_test

    # --- TNBC (Test Set) ---
    - tnbc_test   

    # --- MoNuSeg (Test Set) ---
    - monuseg_test

    # --- NuInsSeg (Test Set) ---
    - nuinsseg_test

    # --- CryoNuSeg (Test Set) ---
    - cryonuseg_test

    # --- BC (Validation Set) ---
    - bc_test

    # --- ConSep (Test Set) ---
    - consep_test

    # --- MoNuSAC (Test Set) ---
    - monusac_test
    
    # --- Kumar (Test Set) ---
    - kumar_test

    # --- CPM-17 (Test Set) ---
    - cpm17_test

    # --- CRC (Held-out for reporting) ---
    - CRC03
    - CRC11
    - CRC37
    
    # (Note: BC and Xenium do not have explicit test sets in this config)

  # --------------------------------------------------------------------------
  # GLOBAL SETTINGS
  # --------------------------------------------------------------------------
  train_ratio: 0.90
  val_ratio: 0.09
  test_ratio: 0.01
  random_seed: 42

  # List of ALL folders to scan (CORRECTED to match Zarr Group Names)
  all_samples:
    # PanNuke
    - pannuke_train
    - pannuke_val
    - pannuke_test
    
    # TissueNet
    - tissuenet_train
    - tissuenet_val
    - tissuenet_test
    
    # Lizard
    - lizard_train
    - lizard_val
    - lizard_test
    
    # MoNuSeg
    - monuseg_train
    - monuseg_val
    - monuseg_test
    
    # TNBC
    - tnbc_train
    - tnbc_val
    - tnbc_test
    
    # NuInsSeg
    - nuinsseg_train
    - nuinsseg_val
    - nuinsseg_test
    
    # CryoNuSeg
    - cryonuseg_train
    - cryonuseg_val
    - cryonuseg_test
    
    # BC
    - bc_train
    - bc_val
    - bc_test

    # ConSep 
    - consep_train
    - consep_val
    - consep_test

    # MoNuSAC
    - monusac_train
    - monusac_val
    - monusac_test

    # Kumar
    - kumar_train
    - kumar_val
    - kumar_test

    # CPM-17
    - cpm17_train
    - cpm17_val
    - cpm17_test

    # Xenium
    - breast
    - cervical
    - lung
    - lungV1
    - lymph_node
    - ovarian
    - pancreasV1
    - prostate
    - skin
    
    # CRC
    - CRC01
    - CRC02
    - CRC03
    - CRC04
    - CRC05
    - CRC06
    - CRC07
    - CRC08
    - CRC09
    - CRC10
    - CRC11
    - CRC12
    - CRC13
    - CRC14
    - CRC15
    - CRC16
    - CRC17
    - CRC18
    - CRC19
    - CRC20
    - CRC21
    - CRC22
    - CRC23
    - CRC24
    - CRC25
    - CRC26
    - CRC27
    - CRC28
    - CRC29
    - CRC30
    - CRC31
    - CRC32
    - CRC33_01
    - CRC33_02
    - CRC34
    - CRC35
    - CRC36
    - CRC37
    - CRC38
    - CRC39
    - CRC40

# ============================================================================
# 3. DATALOADER SETTINGS
# ============================================================================
dataloader:
  batch_size: 4
  num_workers: 16
  pin_memory: True
  persistent_workers: true
  prefetch_factor: 2
  shuffle_train: true

# ============================================================================
# 4. DATA PROCESSING
# ============================================================================
processing:
  normalize: true
  normalize_method: "minmax"
  # Note: PanNuke, Xenium, Lizard, MoNuSeg, TNBC, NuInsSeg, CryoNuSeg, and BC are uint8 (0-255).
  he_max_value: 255.0
  mif_max_value: 65535.0


# ============================================================================
# 5. AUGMENTATION SETTINGS - MAGNIFICATION AGNOSTIC
# ============================================================================
augmentation:
  train_augment: true
  val_augment: false
  test_augment: false
  augment_prob: 1.0  # Always apply augmentation during training
  
  geometric:
    flip_prob: 0.7              # Increased - histology is rotation-invariant
    rotation_prob: 0.6          # Increased - more diverse orientations
    rotation_angles: [90, 180, 270]
    scale_prob: 0.9             # Slightly increased from 0.8
    scale_range: [0.5, 2.0]     # Keep current range
    
    # ‚≠ê NEW: Random resize for magnification invariance
    random_resize_prob: 0.85    # High probability - critical for mag agnostic
    resize_range: [0.5, 2.0]    # Simulates 10x to 40x magnification range
  
  photometric:
    brightness_prob: 0.6        # Increased from 0.5 - scanner variations
    brightness_factor: 0.25     # 1.67x stronger effect
    contrast_prob: 0.5          # Increased from 0.4 - staining intensity variations
    contrast_factor: 0.25       # 1.67x stronger effect
  
  stain:
    stain_prob: 0.5             # 5x increase - CRITICAL for CRC+Xenium+PanNuke
    hue_shift_range: [-0.04, 0.04]      # 2.67x stronger - H&E stain variations
    saturation_range: [0.7, 1.4]        # Much wider - different staining protocols
    value_range: [0.7, 1.3]
    
  noise_blur:
    blur_prob: 0.4              # Keep - simulates focus variations
    blur_sigma_range: [0.1, 1.0]        # Slightly stronger blur
    noise_prob: 0.35            # Slightly increased - sensor noise
    noise_he_std_range: [0.005, 0.03]   # Slightly stronger
    noise_mif_std_range: [0.002, 0.015] # Slightly stronger
  
  cutout:
    cutout_prob: 0.35           # Slightly increased - occlusion robustness
    cutout_size_range: [10, 60] # Larger cutouts for better regularization
# ============================================================================
# 6. HV MAP GENERATION
# ============================================================================
hv_maps:
  generate: true
  method: "pannuke"
  he_nuclei: true
  he_cells: true
  mif_nuclei: true
  mif_cells: true

# ============================================================================
# 7. FILTERING
# ============================================================================
filtering:
  min_instances_per_tile: 0
  filter_empty_masks: true
  min_he_nuclei: 0
  min_he_cells: 0
  min_mif_nuclei: 0
  min_mif_cells: 0

# ============================================================================
# 8. MEMORY & CACHING
# ============================================================================
memory:
  use_cache: false
  force_regenerate_cache: false
  strategy: "memory"
  max_memory_gb: 32.0
  chunk_size: 1000

# ============================================================================
# 9. DEBUGGING
# ============================================================================
debug:
  verbose: true
  max_samples: null
  print_data_stats: true
  validate_data: true